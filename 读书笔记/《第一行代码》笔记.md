# ã€Šç¬¬ä¸€è¡Œä»£ç ã€‹ç¬”è®°

## ç¬¬ 1 ç«  å¼€å§‹å¯ç¨‹

Googleäº2008å¹´æ¨å‡ºäº†Androidçš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬

Androidç³»ç»Ÿæ¶æ„ï¼šLinuxå†…æ ¸å±‚ï¼Œç³»ç»Ÿè¿è¡Œåº“å±‚ï¼Œåº”ç”¨æ¡†æ¶å±‚ï¼Œåº”ç”¨å±‚

## ç¬¬ 2 ç«  å¿«é€Ÿå…¥é—¨Kotlinç¼–ç¨‹

æ‡’çš„è®°å½•äº†ï¼Œç›¸å…³å†…å®¹åœ¨æˆ‘å¦å¤–ä¸€ç¯‡ç¬”è®°ã€ŠKotliné€Ÿæˆã€‹é‡Œå°±æœ‰

## ç¬¬ 3 ç«  Activity

### ä½¿ç”¨Intentåœ¨Activityä¹‹é—´ç©¿æ¢­

1.æ˜¾ç¤ºIntent

```kotlin
val intent = Intent(this,SecondActivity::class.java)
startActivity(intent)
```

2.éšå¼Intent

```kotlin
val intent = Intent("com.example.app.ACTION_MY")
intent.addCategory("com.example.app.CATEGORY_MY")
startActivity(intent)
```

3.å‘ä¸‹ä¸€ä¸ªActivityä¼ å‚

```kotlin
val data = "hello"
val intent = Intent(this,SecondActivity::class.java)
intent.putExtra("data",data)
startActivity(intent)
```

```kotlin
// æ¥æ”¶
val intent = getIntent()
val data = intent.getStringExtra("data")
println(data)
```

4.è¿”å›æ•°æ®ç»™ä¸Šä¸€ä¸ªActivity
```java
Intent intent = new Intent(MainActivity.this, MainActivity2.class);
intent.putExtra("key", "æˆ‘æ˜¯MainActivity,ä½ æ˜¯è°ï¼Ÿ");
startActivityForResult(intent, REQUEST_CODE);
```

```java
protected void onActivityResult(int requestCode, int resultCode, Intent data) {
    super.onActivityResult(requestCode, resultCode, data);
    if (requestCode == REQUEST_CODE && resultCode == RESULT_OK){
        String msg = data.getStringExtra("returnkey");
        Log.d("MainActivityå¾—åˆ°çš„æ•°æ®æ˜¯ï¼š", msg);
    }
}
```

```java
Intent intent = getIntent();
intent.putExtra("returnkey","ä½ å¥½ï¼Œæˆ‘æ˜¯MainActivity 2 ");
setResult(RESULT_OK,intent);
finish();
```

è¦æ³¨æ„çš„æ˜¯ï¼ŒRESULT_OKæ˜¯ç³»ç»Ÿå®šä¹‰çš„ï¼Œè¡¨ç¤ºè¿”å›æˆåŠŸï¼ŒREQUEST_CODEåˆ™æ˜¯è‡ªå·±å®šä¹‰çš„


### ç”Ÿå‘½å‘¨æœŸçš„ç†è§£

| æ–¹æ³•        | è¯´æ˜                                                         |
| ----------- | ------------------------------------------------------------ |
| `onCreate`  | **åœ¨activityç¬¬ä¸€æ¬¡è¢«åˆ›å»ºæ—¶è°ƒç”¨**ï¼Œé€šå¸¸åœ¨è¿™ä¸ªæ–¹æ³•ä¸­å®Œæˆåˆå§‹åŒ–æ“ä½œï¼ˆåˆå§‹åŒ–è§†å›¾ç­‰ç­‰ï¼‰ |
| `onStart`   | **åœ¨activitiy is becoming visible to the useræ—¶è°ƒç”¨**        |
| `onResume`  | **åœ¨activityä¸ç”¨æˆ·äº¤äº’æ—¶è°ƒç”¨**ï¼Œæ­¤æ—¶activityä½äºæ ˆé¡¶         |
| `onPause`   | **åœ¨å¯åŠ¨æˆ–æ¢å¤å¦ä¸€ä¸ªactiviyæ—¶è°ƒç”¨**                          |
| `onStop`    | **åœ¨activityä¸å¯è§çš„æ—¶å€™è°ƒç”¨**ï¼Œåªè¦ä¸å¯è§å°±ä¼šè°ƒç”¨ï¼Œæ¯”å¦‚æ‰‹æœºç†„å±çš„æ—¶å€™ï¼Œåˆ‡æ¢åˆ°å¦ä¸€ä¸ªåº”ç”¨çš„æ—¶å€™ï¼Œéƒ½ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³• |
| `onDestroy` | **åœ¨activityè¢«é”€æ¯å‰è°ƒè°ƒç”¨**                                 |
| `onRestart` | **åœ¨activiyé‡æ–°å¯åŠ¨ä¹‹å‰è°ƒç”¨**ï¼Œæ¯”å¦‚ç”±A activityè·³è½¬åˆ°B activityåï¼Œåœ¨è·³è½¬å›æ¥ï¼Œå°±ä¼šè§¦å‘A activityçš„onRestartæ–¹æ³•ï¼Œæœ‰ä¸€äº›æ“ä½œæ¯”å¦‚æ¨ªç«–å±çš„è½¬å˜ä¹Ÿä¼šè§¦å‘åˆ°onRestartæ–¹æ³•ï¼Œè¿™æ—¶å€™æƒ³ä¿å­˜çŠ¶æ€çš„è¯å¯ä»¥ä½¿ç”¨onSaveInstanceStateæ–¹æ³• |

### å¯åŠ¨æ¨¡å¼

| æ¨¡å¼             | è¯´æ˜                                                         |
| ---------------- | ------------------------------------------------------------ |
| `standard`       | **é»˜è®¤çš„å¯åŠ¨æ¨¡å¼**ï¼Œæ¯æ¬¡å¯åŠ¨åŒä¸€ä¸ªactivityéƒ½ä¼šåˆ›å»ºä¸€ä¸ªå®ä¾‹   |
| `singleTop`      | **æ ˆé¡¶å¤ç”¨æ¨¡å¼**ï¼Œå¦‚æœå‘ç°è¦å¯åŠ¨çš„activiyæ­£å¤„äºæ ˆé¡¶ï¼Œå°±ç›´æ¥ä½¿ç”¨ï¼Œè€Œä¸åˆ›å»ºï¼Œä½†æ˜¯å¦‚æœä¸å¤„äºæ ˆé¡¶ï¼Œåˆ™è¿˜æ˜¯ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹ |
| `singleTask`     | **æ ˆå†…å¤ç”¨æ¨¡å¼**ï¼Œå¦‚æœå‘ç°è¦å¯åŠ¨çš„activityåœ¨æ ˆå†…ï¼Œåˆ™ç›´æ¥ä½¿ç”¨ï¼Œå¹¶ä¸”ä½¿å¤„äºå…¶ä¸Šçš„å…¶ä»–activitiyå‡ºæ ˆï¼Œå¦‚æœè¦å¯åŠ¨çš„activityä¸åœ¨åˆ™åˆ›å»º |
| `singleInstance` | æŒ‡å®šä¸ºsingleInstanceæ¨¡å¼çš„activityä¼šå¯ç”¨ä¸€ä¸ªæ–°çš„è¿”å›æ ˆæ¥ç®¡ç†è¿™ä¸ªactivity |

## ç¬¬ 4 ç«  UI

å¸¸ç”¨æ§ä»¶ï¼šTextView,Button,EditView,ImageView...ç­‰ç­‰

å¸¸è§å¸ƒå±€ï¼šLinearLayout,RelativeLayout,FrameLayout,GridLayout,TableLayout

ä¸‹é¢è¯¦ç»†è®²è®²ä¸‰ç§å¸¸ç”¨çš„å¸ƒå±€ï¼šLinearLayout,RelativeLayout,FrameLayout

LinearLayout çº¿æ€§å¸ƒå±€

å¯ä»¥é€šè¿‡è®¾ç½®å±æ€§`orientation`æ¥è®¾ç½®æ–¹å‘ï¼ˆverticalï¼Œhorizontalï¼‰

RelativeLayout ç›¸å¯¹å¸ƒå±€

å„ç§å±æ€§ï¼š

ä¸parentç›¸å¯¹çš„å±æ€§

| å±æ€§                              | è¯´æ˜                                                         |
| --------------------------------- | ------------------------------------------------------------ |
| `layout_alignParentTop`           | è¡¨ç¤ºwidgetçš„**é¡¶éƒ¨**å’ŒContainerçš„**é¡¶éƒ¨**å¯¹é½ã€‚              |
| `layout_alignParentBottom`        | è¡¨ç¤ºwidgetçš„**åº•éƒ¨**å’ŒContainerçš„**åº•éƒ¨**å¯¹é½ã€‚              |
| `layout_alignParentStart`         | è¡¨ç¤ºwidgetçš„å·¦è¾¹å’ŒContainerçš„èµ·å§‹è¾¹ç¼˜å¯¹é½ã€‚                  |
| `layout_alignParentEnd`           | è¡¨ç¤ºwidgetçš„**å·¦è¾¹**å’ŒContainerçš„ç»“æŸè¾¹ç¼˜å¯¹é½ã€‚              |
| `layout_alignParentLeft`          | è¡¨ç¤ºwidgetçš„**å·¦è¾¹**å’ŒContainerçš„**å·¦è¾¹**å¯¹é½ã€‚              |
| `layout_alignParentRight`         | è¡¨ç¤ºwidgetçš„**å³è¾¹**å’ŒContainerçš„**å³è¾¹**å¯¹é½ã€‚              |
| `layout_centerInParent`           | è¡¨ç¤ºwidgetå¤„äºContainerå¹³é¢ä¸Šçš„**æ­£ä¸­é—´**ã€‚                  |
| `layout_alignWithParentIfMissing` | è‹¥è®¾ç½®trueï¼Œåˆ™å½“è¯¥æ§ä»¶layout_toLeftOf, layout_toRightOfç­‰æ‰¾ä¸åˆ°ç›¸å¯¹çš„å‚è€ƒwidgetæ—¶ï¼Œå°±ä»¥çˆ¶containerä¸ºå‚è€ƒã€‚ |

ä¸widgetç›¸å¯¹çš„å¸ƒå±€

| å±æ€§                      | è¯´æ˜                                                         |
| ------------------------- | ------------------------------------------------------------ |
| `layout_above`            | è¡¨ç¤ºè¯¥widgetä½äºå‚æ•°å€¼æ ‡è¯†çš„widgetçš„ä¸Šæ–¹ã€‚                   |
| `layout_below`            | è¡¨ç¤ºè¯¥widgetä½äºå‚æ•°å€¼æ ‡è¯†çš„widgetçš„ä¸‹æ–¹ã€‚                   |
| `layout_alignTop`         | è¡¨ç¤ºè¯¥widgetçš„**é¡¶éƒ¨**ä¸å‚æ•°å€¼æ ‡è¯†çš„widgetçš„**é¡¶éƒ¨**å¯¹é½ã€‚   |
| `layout_alignBottom`      | è¡¨ç¤ºè¯¥widgetçš„**åº•éƒ¨**ä¸å‚æ•°å€¼æ ‡è¯†çš„widgetçš„**åº•éƒ¨*8å¯¹é½ã€‚   |
| `layout_alignStart`       | è¡¨ç¤ºè¯¥widgetçš„**èµ·å§‹è¾¹ç¼˜**ä¸å‚æ•°å€¼æ ‡è¯†çš„widgetçš„**èµ·å§‹è¾¹ç¼˜**å¯¹é½ã€‚ |
| `layout_alignEnd`         | è¡¨ç¤ºè¯¥widgetçš„**ç»“æŸè¾¹ç¼˜**ä¸å‚æ•°å€¼æ ‡è¯†çš„widgetçš„**ç»“æŸè¾¹ç¼˜**å¯¹é½ |
| `layout_alignLeft`        | è¡¨ç¤ºè¯¥widgetçš„**å·¦è¾¹**ä¸å‚æ•°å€¼æ ‡è¯†çš„widgetçš„**å·¦è¾¹**å¯¹é½ã€‚   |
| `layout_alignRight`       | è¡¨ç¤ºè¯¥widgetçš„**å³è¾¹**å‚æ•°å€¼æ ‡è¯†çš„widgetçš„**å³è¾¹**å¯¹é½ã€‚     |
| `layout_centerHorizontal` | è¡¨ç¤ºwidgetå¤„äºContainer**æ°´å¹³æ–¹å‘ä¸Šçš„ä¸­é—´**ã€‚                |
| `layout_centerVertical`   | è¡¨ç¤ºwidgetå¤„äºContainer**å‚ç›´æ–¹å‘ä¸Šçš„ä¸­é—´**ã€‚                |
| `layout_alignBaseline`    | è¡¨ç¤ºè¯¥widgetçš„BaseLineä¸å‚æ•°å€¼æ ‡è¯†çš„widgetçš„BaseLineå¯¹é½ã€‚   |
| `layout_toLeftOf`         | è¡¨ç¤ºè¯¥widget**ä½äºå‚æ•°å€¼æ ‡è¯†çš„widgetçš„å·¦æ–¹**ã€‚               |
| `layout_toRightOf`        | è¡¨ç¤ºè¯¥widget**ä½äºå‚æ•°å€¼æ ‡è¯†çš„widgetçš„å³æ–¹**ã€‚               |
| `layout_toStartOf`        | ğŸš©è¡¨ç¤ºè¯¥widget**ç»“æŸè¾¹ç¼˜**ä¸å‚æ•°å€¼æ ‡è¯†çš„widgetçš„**èµ·å§‹è¾¹ç¼˜**å¯¹é½ |
| `layout_toEndOf`          | ğŸš©è¡¨ç¤ºè¯¥widget**èµ·å§‹è¾¹ç¼˜**ä¸å‚æ•°å€¼æ ‡è¯†çš„widgetçš„**ç»“æŸè¾¹ç¼˜**å¯¹é½ |

FrameLayout å¸§å¸ƒå±€

FrameLayoutä¼šé»˜è®¤æŠŠæ§ä»¶éƒ½æ”¾äºå·¦ä¸Šè§’

## ç¬¬ 5 ç«  Fragment

### ç”Ÿå‘½å‘¨æœŸ

fragmenté™„ç€äºactivityï¼Œå› æ­¤ï¼Œfragmentçš„ç”Ÿå‘½å‘¨æœŸå’Œactivityçš„ç”Ÿå‘½å‘¨æœŸå¯è°“æ˜¯ç´§ç´§ç›¸è¿åœ¨ä¸€èµ·ï¼Œfragmenté‡Œçš„è®¸å¤šæ–¹æ³•éƒ½æ˜¯åŸºäºactivityçš„

| ç”Ÿå‘½å‘¨æœŸ            | è¯´æ˜                                                         |
| ------------------- | ------------------------------------------------------------ |
| `onAttach`          | **åœ¨fragmentå’Œactivityå»ºç«‹å…³è”æ—¶è°ƒç”¨**                       |
| `onCreate`          | **åœ¨fragmentç¬¬ä¸€æ¬¡è¢«åˆ›å»ºæ—¶è°ƒç”¨**                             |
| `onCreateView`      | **åœ¨fragmentåˆ›å»ºè§†å›¾æ—¶è°ƒç”¨**                                 |
| `onActivityCreated` | **åœ¨ä¸fragmentå…³è”çš„activityåˆ›å»ºå®Œæ¯•æ—¶è°ƒç”¨**                 |
| `onStart`           | **åœ¨fragmentå°†è¦å±•ç¤ºç»™ç”¨æˆ·æ—¶è°ƒç”¨ (å‰ææ˜¯å…³è”çš„activityçš„onStartæ–¹æ³•å·²ç»å®Œæˆ).** |
| `onResume`          | åœ¨fragmentå¯ä»¥å’Œç”¨æˆ·äº¤äº’æ—¶è°ƒç”¨(å‰ææ˜¯å…³è”çš„activityçš„onResumeæ–¹æ³•å·²ç»å®Œæˆ) |
| `onPause`           | fragmentä¸å†ä¸ç”¨æˆ·äº¤äº’æ—¶è°ƒç”¨                                 |
| `onStop`            | fragmentå¯¹ç”¨æˆ·ä¸å¯è§çš„æ—¶å€™è°ƒç”¨                               |
| `onDestroyView`     | å½“ä¸fragmentå…³è”çš„è§†å›¾è¢«ç§»é™¤æ—¶è°ƒç”¨                           |
| `onDestroy`         | é”€æ¯fragmentæ—¶è°ƒç”¨                                           |
| `onDetach`          | å½“fragmentå’Œactivityæ¥è§¦å…³è”æ—¶è°ƒç”¨                           |

### åŠ¨æ€åŠ è½½

```kotlin
val fragmentManager = supportFragmentManager
val transaction = fragmentManager.beginTransaction()
transaction.replace(R.id.right_framelayout,fragment)
transaction.addToBackStack(null)
transaction.commit()
```

## ç¬¬ 6 ç«  BroadcastReceiver

å¹¿æ’­æ¥æ”¶è€…ï¼Œç”¨äºæ¥å—å¹¿æ’­

å¹¿æ’­çš„åˆ†ç±»

- æ ‡å‡†å¹¿æ’­ï¼šå¼‚æ­¥æ‰§è¡Œçš„å¹¿æ’­ï¼Œæ¥æ”¶è€…å‡ ä¹ä¼šåœ¨åŒä¸€æ—¶é—´æ¥æ”¶åˆ°å¹¿æ’­ï¼Œ**æ•ˆç‡é«˜ï¼Œä½†æ— æ³•æˆªæ–­**

- æœ‰åºå¹¿æ’­ï¼šåŒæ­¥æ‰§è¡Œè¿›è¡Œçš„å¹¿æ’­ï¼Œæ¥æ”¶è€…æ¥æ”¶åˆ°å¹¶å¤„ç†å®Œè‡ªå·±çš„é€»è¾‘ä¹‹åæ‰ä¼šç»§ç»­ä¼ é€’ï¼Œ**å¯ä»¥è¿›è¡Œæˆªæ–­**

å…·ä½“å®ç°

```kotlin
val intent = Intent("è·¯å¾„")
intent.setPackage(packageName) //! ï¼ï¼
// æ— åºå¹¿æ’­
sendBroadcast(intent)
// æœ‰åºå¹¿æ’­
sendOrderedBroadcast(intent, null)
```

è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨Android 8.0 ä¹‹åï¼Œé™æ€æ³¨å†Œçš„BroadcastReceiveræ˜¯æ— æ³•æ¥æ”¶éšå¼å¹¿æ’­çš„ï¼ŒåŠ å…¥`intent.setPackage(packageName)`è¿™è¡Œä»£ç ä¹‹åä¼šå°†æ­¤å¹¿æ’­å˜æˆæ˜¾ç¤ºçš„å¹¿æ’­ï¼Œå¦åˆ™æ— æ³•æ¥æ”¶åˆ°è¿™æ¡å¹¿æ’­

å¹¿æ’­çš„æ³¨å†Œæ–¹å¼

åŠ¨æ€æ³¨å†Œ

é€šè¿‡ä»£ç å¯¹å¹¿æ’­è¿›è¡Œæ³¨å†Œ

```kotlin
val intentFilter = IntentFilter() // å®šä¹‰ä¸€ä¸ªè¿‡æ»¤å™¨
intentFilter.addAction("è·¯å¾„")
myReciver = MyReciver()
registerReceiver(myReciver, intentFilter)//æ³¨å†Œ
...
unregisterReceiver(myReciver) // å–æ¶ˆæ³¨å†Œ
```

é™æ€æ³¨å†Œ

ç›´æ¥åœ¨`AndroidManifest`æ–‡ä»¶ä¸­è¿›è¡Œæ³¨å†Œ

```xml
<receiver
    android:name=".OrderlyReceiver"
    android:enabled="true"
    android:exported="true">
    <intent-filter>
        <action android:name="io.github.fourcomponent.MY_BROADCAST" />
    </intent-filter>
</receiver>
```

## ç¬¬ 7 ç«  æ•°æ®å­˜å‚¨

Androidæä¾›äº† 3 ç§å­˜å‚¨æ–¹å¼ï¼šæ–‡ä»¶å­˜å‚¨ï¼ŒSharePreferenceså­˜å‚¨ï¼Œsqliteæ•°æ®åº“å­˜å‚¨

æ–‡ä»¶å­˜å‚¨

```kotlin
// å­˜å‚¨
val inputString = editView.text.toString()
val ouput = openFileOutput("data",Context.MODE_PRIVATE)
val writer = BufferedWriter(OutputStreamWriter(ouput))
writer.use {
    it.write(inputString)
}
// è¯»å–
val input = openFileInput("data")
val reader = BufferedReader(InputStreamReader(input))
reader.use{
    reader.forEachLine {
        println(it)
    }
}
```

SharePreferenceså­˜å‚¨

```kotlin
val sp = getSharedPreferences("data", Context.MODE_PRIVATE)
// å­˜å‚¨
sp.edit().putString("name", "Tom")
sp.apply()
// è¯»å–
sp.getString("name",null)
```

sqliteæ•°æ®åº“å­˜å‚¨

```kotlin
// å¸®åŠ©ç±»
public class MyDatabaseHelper extends SQLiteOpenHelper {

    private String createBook = "create table Book(" +
            "    id integer primary key autoincrement," +
            "    author text," +
            "    name text)";

    public MyDatabaseHelper(@Nullable Context context, @Nullable String name, @Nullable SQLiteDatabase.CursorFactory factory, int version) {
        super(context, name, factory, version);
    }

    @Override
    public void onCreate(SQLiteDatabase db) {
        db.execSQL(createBook);
        Log.e("==> ","åˆ›å»ºæ•°æ®åº“æˆåŠŸ");
    }
    // æ›´æ–°ï¼Œç‰ˆæœ¬å·ä¸ä¸€æ ·å°†ä¼šæ‰§è¡Œè¿™ä¸ªæ–¹æ³•
    @Override
    public void onUpgrade(SQLiteDatabase db, int oldVersion, int newVersion) {
        db.execSQL("drop table if exists Book");
        onCreate(db);
    }
}
// åˆ›å»º
MyDatabaseHelper dbHelper = new MyDatabaseHelper(this,"BookStore.db",null,1);
SQLiteDatabase db = dbHelper.getWritableDatabase(); // æˆ–è€… dbHelper.getReadableDatabase();
// å¢åŠ 
db.execSQL("insert into Book(author,name) values(?,?)", new String[]{"é²è¿…", "ç‹‚äººæ—¥è®°"});
// åˆ é™¤
db.execSQL("delete from Book where id = ?", new String[]{"1"});
// ä¿®æ”¹
db.execSQL("update Book set name = ? where id = ?", new String[]{"ç™¾è‰å›­åˆ°ä¸‰å‘³ä¹¦å±‹", "1"});
// æŸ¥è¯¢
Cursor cursor = db.rawQuery("select * from Book", null);
if (cursor.moveToFirst()) {
    do {
        int id = cursor.getInt(cursor.getColumnIndex("id"));
        String name = cursor.getString(cursor.getColumnIndex("name"));
        String author = cursor.getString(cursor.getColumnIndex("author"));
        Log.e("==> ", "id = " + id + " name = " + name + " author = " + author);
    } while (cursor.moveToNext());
}
// ä½¿ç”¨äº‹åŠ¡
db.beginTransaction();
try {
    // å„ç§æ“ä½œ
    db.setTransactionSuccessful();
} catch (Exception e) {
    e.printStackTrace();
} finally {
    db.endTransaction();
}
```


getWritableDatabaseå’ŒgetReadableDatabaseæ–¹æ³•éƒ½æ˜¯æ‰“å¼€æˆ–è€…åˆ›å»ºä¸€ä¸ªæ•°æ®åº“ï¼Œä¸åŒçš„æ˜¯ï¼Œå½“æ§ä»¶æ»¡äº†çš„æ—¶å€™ï¼ŒgetReadableDatabaseä¼šä»¥åªè¯»çš„æ–¹å¼æ‰“å¼€æ•°æ®åº“ï¼Œè€ŒgetWritableDatabaseä¼šæŠ¥é”™


## ç¬¬ 8 ç«  ContentProvider

æƒé™é—®é¢˜ï¼š**ä»Android 6.0 å¼€å§‹ï¼Œå±é™©æƒé™éœ€è¦ç”¨æˆ·æ‰‹åŠ¨æˆæƒæ‰å¯ä½¿ç”¨**

è¿™ä¸€ç« å…¶ä½™å†…å®¹æ ¹æœ¬ä¸æƒ³çœ‹ï¼Œå…ˆä¸çœ‹äº†

 

## ç¬¬ 9 ç«  å¤šåª’ä½“

é€šçŸ¥çš„ä½¿ç”¨

```kotlin
// åˆ›å»ºNotificationManager
val manager = getSystemService(Context.NOTIFICATION_SERVICE) as NotificationManager

// åˆ›å»ºé€šçŸ¥æ¸ é“
if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.O) {
    val channel = NotificationChannel("normal", "Normal", NotificationManager.IMPORTANCE_DEFAULT)
    manager.createNotificationChannel(channel)
}
// è¿›è¡Œé€šçŸ¥
val intent = Intent(this, MainActivity2::class.java)
val pi = PendingIntent.getActivity(this, 0, intent, 0)

val notification = NotificationCompat.Builder(this, "normal")
.setContentTitle("this is content title")
.setContentText("this is content text")
.setSmallIcon(R.drawable.ic_launcher_foreground)
.setContentIntent(pi) // è®¾ç½®ç‚¹å‡»åè§¦å‘çš„äº‹ä»¶
.setAutoCancel(true) // ç‚¹å‡»åè‡ªåŠ¨æ¶ˆå¤±
.build()
manager.notify(1, notification) // å‘é€é€šçŸ¥
```



è¿™ç« å…¶ä»–ä¹Ÿä¸æƒ³çœ‹äº†ï¼Œéƒ½æ˜¯ä¸€äº›æ¯”è¾ƒåŸºç¡€çš„ä¸œè¥¿

## ç¬¬ 10 ç«  Service

serviceçš„ç”Ÿå‘½å‘¨æœŸ

serviceçš„ç”Ÿå‘½å‘¨æœŸå¯ä»¥åˆ†ä¸ºä¸¤ä¸ªç§æƒ…å†µï¼Œä¸€ç§æ˜¯ä¸ç»‘å®šç›´æ¥å¯åŠ¨ï¼Œä¸€ç§æ˜¯è¢«ç»‘å®šåå¯åŠ¨

**ä¸ç»‘å®šç›´æ¥å¯åŠ¨çš„ç”Ÿå‘½å‘¨æœŸ**

| ç”Ÿå‘½å‘¨æœŸ         | è¯´æ˜                        |
| ---------------- | --------------------------- |
| `onCreate`       | ç¬¬ä¸€æ¬¡**åˆ›å»º**serviceæ—¶è°ƒç”¨ |
| `onStartCommand` | æ¯æ¬¡**å¯åŠ¨**serviceæ—¶è°ƒç”¨   |
| `onDestroy`      | serviceé”€æ¯æ—¶è°ƒç”¨           |

è¿™é‡Œè¦æ³¨æ„ç†è§£ä¸‹`onCreate`å’Œ`onStartCommand`çš„åŒºåˆ«ï¼Œ`onCreate`æ–¹æ³•åªèƒ½åœ¨æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­åªèƒ½ä½¿ç”¨ä¸€æ¬¡ï¼Œè€Œ`onStartCommand`å¯ä»¥ä½¿ç”¨å¾ˆå¤šæ¬¡ï¼Œå³æ¯æ¬¡å¯åŠ¨serviceçš„æ—¶å€™éƒ½ä¼šç”¨åˆ°`onStartCommand`ï¼Œä½†ä¸æ˜¯æ¯æ¬¡éƒ½ä¼šç”¨åˆ°`onCreate`ï¼ˆå› ä¸ºå¯èƒ½ä¹‹å‰è¢«åˆ›å»ºåäº†ï¼‰

è¿˜æœ‰ä¸€ç‚¹è¦æ³¨æ„çš„æ—¶ï¼Œ**æ¯ä¸ªserviceåªä¼šå­˜åœ¨ä¸€ä¸ªå®ä¾‹**

**ç»‘å®šåå¯åŠ¨çš„ç”Ÿå‘½å‘¨æœŸ**

| ç”Ÿå‘½å‘¨æœŸ    | è¯´æ˜                                                    |
| ----------- | ------------------------------------------------------- |
| `onCreate`  | ç¬¬ä¸€æ¬¡**åˆ›å»º**serviceæ—¶è°ƒç”¨ï¼Œå’Œä¸Šé¢çš„ä¸€æ ·ï¼Œè¿™é‡Œä¸å†èµ˜è¿° |
| `onBind`    | ç»‘å®š                                                    |
| `onDestroy` | serviceé”€æ¯æ—¶è°ƒç”¨                                       |

å…·ä½“å®ç°

 ```kotlin
// ä¸ç»‘å®šç›´æ¥å¯åŠ¨
val intent = Intent(this, MyService::class.java)
startService(intent)// å¼€å¯service
stopService(intent)// åœæ­¢serviceï¼Œè¿™æ—¶å€™ä¼šè°ƒç”¨onDestroyæ–¹æ³•
// ç»‘å®šåå¯åŠ¨
var connnect = object : ServiceConnection {
    override fun onServiceDisconnected(name: ComponentName?) {
        TODO("Not yet implemented")
    }
    override fun onServiceConnected(name: ComponentName?, service: IBinder?) {
        // åœ¨è¿™é‡Œä¼šå¾—åˆ°ä¸€ä¸ªIBinderæ¥å£å˜é‡ï¼Œåœ¨è¿™é‡Œå¯ä»¥åšä¸€äº›activityå’Œserviceçš„äº¤äº’
    }
}
val intent = Intent(this, MyService::class.java)
bindService(intent, connnect, Context.BIND_AUTO_CREATE)
unbindService(connnect)
 ```

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸€ä¸ªserviceåªè¦è¢«å¯åŠ¨æˆ–è€…ç»‘å®šä¹‹åï¼Œå°±ä¼šå¤„äºè¿è¡Œçš„çŠ¶æ€ï¼Œä½†æ˜¯å¦‚æœä¸€ä¸ªserviceä¸ä»…è¢«ç»‘å®šäº†ï¼Œè€Œä¸”è¿˜è¢«å¯åŠ¨äº†ï¼Œè¿™æ—¶å€™æƒ³è¦é”€æ¯serviceå°±å¿…é¡»è°ƒç”¨`stopService(intent)`å’Œ`unbindService(connnect)`è¿™ä¸¤ä¸ªæ–¹æ³•ã€‚

**å¼‚æ­¥æ¶ˆæ¯å¤„ç†æœºåˆ¶**

ç”±4ä¸ªéƒ¨åˆ†ç»„æˆ

- Messageï¼šæ¶ˆæ¯ï¼Œçº¿ç¨‹ä¹‹é—´ä¼ é€’çš„æ¶ˆæ¯
- Handlerï¼šå¤„ç†è€…ï¼Œç”¨äºå‘é€å’Œå¤„ç†æ¶ˆæ¯ï¼Œæ¶ˆæ¯æœ€ç»ˆéƒ½ä¼šä¼ é€’åˆ°handleMessage()æ–¹æ³•ä¸­å¤„ç†
- MessageQueueï¼šæ¶ˆæ¯é˜Ÿåˆ—ï¼Œç”¨äºå­˜æ”¾æ‰€æœ‰é€šè¿‡Handlerå‘é€çš„æ¶ˆæ¯
- Looperï¼šå°†MessageQueueé‡Œçš„æ¶ˆæ¯ä¼ é€’ç»™Handlerçš„handleMessage()æ–¹æ³•ä¸­

é€»è¾‘ï¼šHandleré€šè¿‡å‘é€Messageåˆ°MessageQueueé‡Œï¼ŒLooperåˆå°†Messageä¼ é€’ç»™Handlerçš„handleMessage()æ–¹æ³•

## ç¬¬ 13 ç«  Jetpack

